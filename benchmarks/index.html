<html>

<head>
    <title>Document</title>
    <script src="../dist/standard.js"></script>
    <style>
        .wrapper {
            height: 50vh;
            overflow: scroll;
        }
    </style>
</head>

<body>
    <div class="wrapper"></div>
    <script>

        const wrapper = document.querySelector('.wrapper');

        let rowContents = [];

        const app = okwolo(wrapper);
        app.setState({});
        app(() => () => (
            ['table', {},
                rowContents.map((contents) => (
                    ['tr', {}, [
                        ['td', {}, [
                            contents
                        ]],
                    ]]
                )),
            ]
        ));

        const tests = [
            {
                title: 'Create 10,000 rows',
                rows: () => Array.apply(null, Array(10000)).map(() => 'TEST'),
            },
            {
                title: 'Append 1,000 rows',
                rows: (temp) => temp.concat(temp.slice(0, 999)),
            },
            {
                title: 'Remove 1,000 rows',
                rows: (temp) => temp.slice(0, 9999),
            },
            {
                title: 'Update 10% of rows',
                rows: (temp) => temp.map(() => Math.random() < 0.10 ? 'UPDATED' : 'TEST'),
            },
            {
                title: 'Update all rows',
                rows: (temp) => temp.map(() => 'UPDATED'),
            },
            {
                title: 'Remove all rows',
                rows: () => [],
            },
        ];

        const run = (index) => {
            
            if (!tests[index]) {
                return;
            }
            const {title, rows} = tests[index];
            rowContents = rows(rowContents).slice();
            window.requestAnimationFrame(() => {
                const startTime = Date.now();
                app.update();
                setTimeout(() => {
                    window.requestAnimationFrame(() => {
                        console.log(`${title}: ${Date.now() - startTime}ms`);
                        run(++index);
                    });
                }, 0);
            });
        };

        run(0);

    </script>
</body>

</html>