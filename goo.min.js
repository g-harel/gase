var goo=function(a,b){function e(a,b,c){function d(a,d,f){var a=JSON.parse(JSON.stringify(a));void 0===f&&(f={});var g=[e];return b.reverse().forEach(function(a,b){g[b+1]=function(c,d,e){return a(g[b],c,d,e)}}),a=JSON.parse(JSON.stringify(g[b.length](a,d,f))),c.forEach(function(b){b(JSON.parse(JSON.stringify(a)),d,f)}),a}function e(b,c,d){var e=JSON.parse(JSON.stringify(b));return a.forEach(function(a,b){var f=a[c];f&&f.forEach(function(a){var b=JSON.parse(JSON.stringify(e));a.target.forEach(function(a,c){b=void 0!==b[a]?b[a]:{}}),b=a.do(b,d);for(var c=a.target.length-1;c>=0;--c){var f={};f[a.target[c]]=b,b=f}e=Object.assign(e,b)})}),e}return void 0===a&&(a=[{}]),void 0===b&&(b=[]),void 0===c&&(c=[]),Array.isArray(a)||(a=[a]),a.forEach(function(a,b){Object.keys(a).forEach(function(c,d){"function"==typeof a[c]&&(a[c]={target:[],do:a[c]}),Array.isArray(a[c])||(a[c]=[a[c]]),a[c].forEach(function(a,d){if(void 0===a.target)a.target=[];else if("string"==typeof a.target)a.target=[a.target];else if(!Array.isArray(a.target))throw new Error(`Target of action ${d} of type ${c} in action types ${b} is not an array`);if("function"!=typeof a.do)throw new Error(`Property "do" of action ${d} of type ${c} in action types ${b} is not a function`);a.target.forEach(function(a,e){if("string"!=typeof a&&"number"!=typeof a)throw new Error(`Key at index ${e} of target of action ${d} of type ${c} in action types ${b} is not valid`)})})})}),Array.isArray(b)||(b=[b]),b.forEach(function(a,b){if("function"!=typeof a)throw new Error(`Middleware at index ${b} is not a function`)}),Array.isArray(c)||(c=[c]),c.forEach(function(a,b){if("function"!=typeof a)throw new Error(`Watcher at index ${b} is not a function`)}),{act:d}}function f(a,b,c,d,f){function m(b,c){l=!0;var d=JSON.parse(JSON.stringify(a));return k.push(j.pop()),j.forEach(function(a){d=q(d,a.type,a.params)}),i=d,l=!1,i}function n(a,b){l=!0;var c=k.pop();return j.push(c),i=q(i,c.type,c.params),l=!1,i}var g=f.history_length||20,h=f.history_buffer;void 0===h?h=5:h<1&&(h=1,--g),a=JSON.parse(JSON.stringify(a));var i=JSON.parse(JSON.stringify(a)),j=[],k=[],l=!1;Array.isArray(b)||(b=[b]),b.push({UNDO:m,REDO:n}),f.state_log===!0&&(void 0===c?c=[]:Array.isArray(c)||(c=[c]),c.unshift(function(a,b,c,d){var e=a(b,c,d);return l||(console.log("state > %c%s","color:#a00;",JSON.stringify(b)),console.log("%c%s","font-size:20px;",c+" "+JSON.stringify(d)),console.log("state > %c%s","color:#0a0;",JSON.stringify(e))),e})),void 0===d?d=[]:Array.isArray(d)||(d=[d]);var o=d;watcher=function(a,b,c){l||o.forEach(function(d){d(a,b,c)})};var p=e(b,c,watcher),q=p.act;return p.act=function(b,c){if(!("UNDO"===b&&j.length<1||"REDO"===b&&k.length<1)){if("UNDO"!==b&&"REDO"!==b){if(j.push({type:b,params:c}),j.length>g+h){l=!0;for(let b=0;b<h;++b){var d=j.shift();a=q(a,d.type,d.params)}l=!1}k=[]}i=q(i,b,c)}},p}function g(a,b,c){function e(a){if(!a.tagName)return a.DOM=document.createTextNode(a.text),a;var b=document.createElement(a.tagName);return a.attributes&&Object.keys(a.attributes).forEach(function(c){b[c]=a.attributes[c]}),a.style&&Object.keys(a.style).forEach(function(c){b.style[c]=a.style[c]}),a.children&&Object.keys(a.children).forEach(function(c){a.children[c]=e(a.children[c]),b.appendChild(a.children[c].DOM)}),a.DOM=b,a}function f(a){function c(a,b,d,f){if(void 0!==a||void 0!==b)if(void 0===a)d.children[f]=e(b),d.DOM.appendChild(d.children[f].DOM);else if(void 0===b)d.DOM.removeChild(a.DOM),d.children[f]=void 0;else{if(a.tagName!==b.tagName){var h=a.DOM;d.children[f]=e(b),d.DOM.replaceChild(d.children[f].DOM,h)}else if(3===a.DOM.nodeType)a.text!==b.text&&(a.DOM.nodeValue=b.text,a.text=b.text);else{var i=g(a.style,b.style),j=g(a.attributes,b.attributes);void 0!==i.length&&(a.DOM.style.cssText=null,Object.keys(b.style).forEach(function(c){a.style[c]=b.style[c],a.DOM.style[c]=b.style[c]})),void 0!==j.length&&j.forEach(function(c){a.attributes[c]=b.attributes[c],a.DOM[c]=b.attributes[c]})}var k=Object.keys(a.children||{}).concat(Object.keys(b.children||{})),l={};k.forEach(function(d){void 0===l[d]&&(l[d]=!0,c(a.children[d],b.children[d],a,d))})}}c(d,b(a),{})}function g(a,b,c){c=c||{};var d=Object.prototype.toString.call(a),e=Object.prototype.toString.call(b);if(d!==e)return!1;if("[object Function]"===d)return!1;if("[object Object]"===d||"[object Array]"===d){var f=Object.keys(a),h=Object.keys(b);if("[object Array]"===d){var i=h.length-f.length;if(i>0)for(let a=i;a>0;--a)f.push(h[h.length-a])}else{var j={};f.forEach(function(a){j[a]=!0}),h.forEach(function(a){j[a]||f.push(a)})}return f.reduce(function(d,e){if(void 0!==c[e])return d;var f=g(a[e],b[e],c);return f!==!0&&("boolean"==typeof d&&(d=[]),f===!1?d.push([e]):f.forEach(function(a){a.unshift(e),d.push(a)})),d},!0)}return a===b}var d={};if(!a instanceof Node)throw new Error("target is not a DOM node");if("function"!=typeof b)throw new Error("create attribute is not a function");return d=e(b(c)),a.innerHTML="",a.appendChild(d.DOM),{update:f}}var c=g(a.target,a.builder,a.state);void 0===a.watchers?a.watchers=[]:Array.isArray(a.watchers)||(a.watchers=[a.watchers]),a.watchers.push(c.update);var d=f(a.state,a.actions,a.middleware,a.watchers,b||{});return{act:d.act}};