(function(){"use strict";var n={enumerable:!1,configurable:!0,writable:!0},t=this,e=t.Object.defineProperty,r=function(n){var e=t.JSON.stringify(n,function(n,t){return"function"==typeof t?t.toString():t},2);return"\n>>> "+t.String(e).replace(/\n/g,"\n    ")},i=function(n){return void 0!==n},o=function(n){return t.Array.isArray(n)},a=function(n){return"function"==typeof n},u=function(n){return"string"==typeof n},c=function(n){return"number"==typeof n},l=function(n){return!!n&&n.constructor===t.Object},d=function(n){return!!(n&&n.tagName&&n.nodeName&&n.ownerDocument&&n.removeAttribute)},s=function(n){if(void 0!==n)return t.JSON.parse(t.JSON.stringify(n))},f=function(n,e){for(var i=arguments.length,o=t.Array(i>2?i-2:0),a=2;a<i;a++)o[a-2]=arguments[a];if(!n)throw new t.Error("@okwolo."+e+o.map(r).join(""))},b=function(n,e){if(t.Array.isArray(n))return n;if(t.Symbol.iterator in t.Object(n))return function(n,e){var r=[],i=!0,o=!1,a=void 0;try{for(var u,c=n[t.Symbol.iterator]();!(i=(u=c.next()).done)&&(r.push(u.value),!e||r.length!==e);i=!0);}catch(n){o=!0,a=n}finally{try{!i&&c.return&&c.return()}finally{if(o)throw a}}return r}(n,e);throw new t.TypeError("Invalid attempt to destructure non-iterable instance")},h=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];!function(n,e){if(!(n instanceof e))throw new t.TypeError("Cannot call a class as a function")}(this,h),this.list=n;for(var e="root",r=this.list.length-1;r>=0;--r){e+=" -> ";var i=this.list[r],o=i.tag,a=i.key;u(o)?(e+=o.substr(0,16),o.length>16&&(e+="...")):e+="{{"+a+"}}"}this.f=e},v=h.prototype,p=function(){for(var n=arguments.length,e=t.Array(n),r=0;r<n;r++)e[r]=arguments[r];return e.map(function(n){return u(n)?n:o(n)?p.apply(void 0,function(n){if(t.Array.isArray(n)){for(var e=0,r=t.Array(n.length);e<n.length;e++)r[e]=n[e];return r}return t.Array.from(n)}(n)):l(n)?p(t.Object.keys(n).map(function(t){return n[t]&&t})):void 0}).filter(t.Boolean).join(" ")},g=function(n,e){y.browser&&(i(e)||(f(void 0!==t.window,"app : must be run in a browser environment"),e=t.window));var r,c,d,s=function(){},b=function(){return s.apply(void 0,arguments)};return t.Object.assign(b,(r={},c={},{on:function(n,t){f(u(n),"on : handler type is not a string",n),f(a(t),"on : handler is not a function",t),i(r[n])||(r[n]=[]),r[n].push(t)},send:d=function(n){for(var e=arguments.length,i=t.Array(e>1?e-1:0),a=1;a<e;a++)i[a-1]=arguments[a];f(u(n),"send : event type is not a string",n);var c=r[n];if(o(c))for(var l=0;l<c.length;++l)c[l].apply(c,i)},use:function(n){for(var e=arguments.length,r=t.Array(e>1?e-1:0),o=1;o<e;o++)r[o-1]=arguments[o];if(u(n))d.apply(void 0,["blob."+n].concat(r));else{f(l(n),"use : blob is not an object",n);var a=n.name;if(i(a)){if(f(u(a),"utils.bus : blob name is not a string",a),i(c[a]))return;c[a]=!0}for(var s=t.Object.keys(n),b=0;b<s.length;++b){var h=s[b];d("blob."+h,n[h])}}}})),b.on("blob.api",function(n,e){f(l(n),"on.blob.api : additional api is not an object",n),t.Object.keys(n).forEach(function(t){e||f(!b[t],'on.blob.api : cannot add key "'+t+'" because it is already defined'),b[t]=n[t]})}),b.on("blob.primary",function(n){f(a(n),"on.blob.primary : primary is not a function",n),s=n}),m.forEach(function(n){n({on:b.on,send:b.send},e)}),i(n)&&b.use("target",n),b},y={kit:"lite",browser:!0};n.value=function(n){return new h([{key:n}].concat(this.list))},e(v,"addKey",n),n.value=function(n){if(0===this.list.length)return new h([{tag:n}]);var t=this.list.slice();return t[0].tag=n,new h(t)},e(v,"addTag",n),n.value=function(){var n=[];if(this.list.length<2)return[];for(var t=this.list.length-2;t>=0;--t)n.push(""+this.list[t].key);return n},e(v,"keyList",n);var w=/:\w+/g,m=[function(n){var t=n.on,e=n.send,r={},i=r,o=void 0;t("state",function(n){i=n}),t("blob.handler",function(n){f(a(n),"on.blob.handler : handler generator is not a function",n);var t=n(function(){return i});f(a(t),"on.blob.handler : handler from generator is not a function",t),o=t}),e("blob.handler",function(){return function(n){e("state",n)}});e("blob.api",{setState:function(n){var t=a(n)?n(s(i)):n;o(t)},getState:function(){return f(i!==r,"state.getState : cannot get state before it has been set"),s(i)}})},function(n){var e=n.on,r=n.send,o=void 0,u=void 0,c=void 0,l=void 0,d=void 0,s=void 0,b=void 0;e("blob.target",function(n){o=n,r("update",!0)}),e("blob.builder",function(n){f(a(n),"on.blob.builder : builder is not a function",n),u=n,r("update",!1)}),e("blob.draw",function(n){f(a(n),"on.blob.draw : new draw is not a function",n),l=n,r("update",!0)}),e("blob.update",function(n){f(a(n),"on.blob.update : new target updater is not a function",n),d=n,r("update",!1)}),e("blob.build",function(n){f(a(n),"on.blob.build : new build is not a function",n),c=n,r("update",!1)}),e("state",function(n){f(i(n),"on.blob.state : new state is not defined",n),b=n,r("update",!1)});var h=!1,v=!1,p=null;e("update",function(n){if(!v){if(!(i(o)&&i(u)&&i(b)))return void(p||(p=t.setTimeout(function(){var n={builder:u,state:b,target:o};t.Object.keys(n).forEach(function(t){n[t]=n[t]?"ok":"waiting"}),f(v,"view : still waiting to draw after "+t.Math.round(3)+"s",n)},3e3)));v=!0}if(n||!h)return s=l(o,c(u(b))),void(h=!0);s=d(o,c(u(b)),[],s)}),e("sync",function(n,t){f(h,"view.sync : cannot sync component before app has drawn"),s=d(o,t,n,s)}),r("blob.api",{update:function(){return r("update",!1)}}),r("blob.primary",function(n){r("blob.builder",n())})},function(n){var e=n.send;e("blob.build",function n(r){var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new h;if("boolean"==typeof r&&(r=null),null===r)return{text:""};if(c(r)&&(r=""+r),u(r))return{text:r};if(f(o(r),"view.build : vdom object is not a recognized type",d.f,r),a(r[0])){var s=b(r,3),v=s[0],g=s[1],y=void 0===g?{}:g,w=s[2],m=void 0===w?[]:w;f(l(y),"view.build : component's props is not an object",d.f,r,y),f(o(m),"view.build : component's children is not an array",d.f,r,m);var O=void 0;return O=v(t.Object.assign({},y,{children:m}),function(){e("sync",d.keyList(),n(O.apply(void 0,arguments),d))}),n(O(),d)}var k=b(r,3),j=k[0],M=k[1],D=void 0===M?{}:M,x=k[2],A=void 0===x?[]:x;f(u(j),"view.build : tag property is not a string",d.f,r,j),f(l(D),"view.build : attributes is not an object",d.f,r,D),f(o(A),"view.build : children of vdom object is not an array",d.f,r,A);var N=/^ *?(\w+?) *?(?:#([-\w\d]+?))? *?((?:\.[-\w\d]+?)*?)? *?(?:\|\s*?([^\s][^]*?))? *?$/.exec(j);f(o(N),"view.build : tag property cannot be parsed",d.f,j);var S=b(N,5),E=S[1],C=S[2],T=S[3],$=S[4];i(C)&&!i(D.id)&&(D.id=C.trim()),(i(D.className)||i(T))&&(D.className=p(D.className,T).replace(/\./g," ").replace(/  +/g," ").trim()),i($)&&(i(D.style)?($=($+";").replace(/;;$/g,";"),D.style=$+D.style):D.style=$),d=d.addTag(j);for(var J={},L=[],q=0;q<A.length;++q){var B=A[q],F=q,I=n(B,d.addKey(F));I.attributes&&"key"in I.attributes&&(F=I.attributes.key,f(c(F)||u(F),"view.build : invalid element key type",d.f,F),f((""+F).match(/^[\w\d-_]+$/g),"view.build : invalid character in element key",d.f,F)),f(!J[F=""+F],"view.build : duplicate child key",d.f,F),L.push(F),J[F]=I}return{tagName:E,attributes:D,children:J,childOrder:L}})},function(n,e){var r=n.send,o=function n(r){if(i(r.text))return r.DOM=e.document.createTextNode(r.text),r;var o=e.document.createElement(r.tagName);t.Object.assign(o,r.attributes);for(var a=0;a<r.childOrder.length;++a){var u=r.childOrder[a],c=n(r.children[u]).DOM;o.appendChild(c)}return r.DOM=o,r},u=function n(e,r,u,c,l){if(i(r)){if(!i(u)){var d=c.DOM,s=r.DOM;return e.push(function(){d.removeChild(s)}),void delete c.children[l]}if(r.tagName!==u.tagName){var f=r.DOM,b=o(u),h=c.DOM,v=b.DOM;return e.push(function(){h.replaceChild(v,f)}),void t.Object.assign(r,{DOM:void 0,text:void 0,tagName:void 0,attributes:void 0,children:void 0,childOrder:void 0},b)}if(void 0===r.text){for(var p=function(n,e){for(var r=t.Object.keys(t.Object.assign({},n,e)),i=[],o=0;o<r.length;++o){var u=r[o],c=n[u],l=e[u];(a(c)||a(l))&&i.push(u),c!==l&&i.push(u)}return i}(r.attributes,u.attributes),g=function(n){var t=p[n],i=u.attributes[t];r.attributes[t]=i;var o=r.DOM;e.push(function(){o[t]=i})},y=0;y<p.length;++y)g(y);var w=r.childOrder.slice();r.childOrder=u.childOrder;var m=t.Object.keys(t.Object.assign({},r.children,u.children));for(y=0;y<m.length;++y){var O=m[y];r.children[O]?u.children[O]||w.splice(w.indexOf(O),1):w.push(O),n(e,r.children[O],u.children[O],r,O)}if(w.length){for(var k=function(n,e){for(var r=e.length,i=r/2,o=0,a=0,u=0;u<r;++u){for(var c=n.indexOf(e[u]),l=t.Math.min(r-c,r-u),d=1,s=1;s<l&&e[u+s]===n[c+s];++s)d+=1;if(d>o&&(o=d,a=u),o>=i)break}return{start:a,end:a+o-1}}(w,u.childOrder),j=k.start,M=k.end,D=u.childOrder.slice(0,j),x=function(n){var t=D[n],i=r.DOM,o=r.children[t].DOM;e.push(function(){i.insertBefore(o,i.firstChild)})},A=D.length-1;A>=0;--A)x(A);for(var N=u.childOrder.slice(M+1,t.Infinity),S=function(n){var t=N[n],i=r.DOM,o=r.children[t].DOM;e.push(function(){i.appendChild(o)})},E=0;E<N.length;++E)S(E)}}else{var C=u.text;if(r.text!==C){var T=r.DOM;e.push(function(){T.nodeValue=C}),r.text=C}}}else{c.children[l]=o(u);var $=c.DOM,J=c.children[l].DOM;e.push(function(){$.appendChild(J)})}};r("blob.draw",function(n,t){return f(d(n),"view.dom.draw : target is not a DOM node",n),o(t),e.requestAnimationFrame(function(){n.innerHTML="",n.appendChild(t.DOM)}),t}),r("blob.update",function(n,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=arguments[3];f(d(n),"view.dom.update : target is not a DOM node",n);for(var a={DOM:n,children:{root:o},childOrder:["root"]},c="root",l=o,s=0;s<i.length;++s)c=i[s],a=l,l=l.children[c];var b=[];return u(b,l,r,a,c),e.requestAnimationFrame(function(){try{for(var n=0;n<b.length;++n)b[n]()}catch(n){t.console.error("view.dom.update : "+n)}}),o})},function(n,e){var r,i,o=n.on,c=n.send,d=null!==e.document.origin&&"null"!==e.document.origin,s="",b=void 0,h=void 0,v=void 0,p=!1,g=(r=[],i=function(){var n=r[0];n&&n()},{add:function(n){r.push(n),1===r.length&&i()},done:function(){r.shift(),i()}}),y=function(){for(var n=arguments.length,e=t.Array(n),r=0;r<n;r++)e[r]=arguments[r];f(a(v),"router : fetch is not a function",v),v.apply(void 0,[b].concat(e))},w=function(n){var e=s.replace(/([^\w])/g,"\\$1");return n.replace(new t.RegExp("^"+e),"")||""},m=e.location.pathname;d||(m=""),e.onpopstate=function(){g.add(function(){m=w(e.location.pathname),y(m),g.done()})},o("blob.route",function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=n.path,e=n.handler;f(u(t),"on.blob.route : path is not a string",t),f(a(e),"on.blob.route : handler is not a function",t,e),f(a(h),"on.blob.route : register is not a function",h),g.add(function(){b=h(b,t,e),p||(p=!!y(m)),g.done()})}),o("blob.base",function(n){f(u(n),"on.blob.base : base url is not a string",n),g.add(function(){s=n,m=w(m),y(m),g.done()})}),o("blob.register",function(n){f(a(n),"on.blob.register : register is not a function",h),g.add(function(){h=n,g.done()})}),o("blob.fetch",function(n){f(a(n),"on.blob.fetch : fetch is not a function",v),g.add(function(){v=n,g.done()})}),o("redirect",function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};f(u(n),"on.redirect : path is not a string",n),f(l(r),"on.redirect : params is not an object",r),g.add(function(){m=n,d?e.history.pushState({},"",(s+m).replace(/^\/C\:/,"")):t.console.log("@okwolo : path changed to\n>>> "+m),y(m,r),g.done()})}),o("show",function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};f(u(n),"on.show : path is not a string",n),f(l(t),"on.show : params is not an object",t),g.add(function(){y(n,t),g.done()})}),c("blob.api",{redirect:function(n,t){return c("redirect",n,t)},show:function(n,t){return c("show",n,t)}})},function(n){(0,n.send)("blob.fetch",function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments[1],e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=!1;return n.find(function(n){var i=n.pattern.exec(t);if(null!==i)return r=!0,i.shift(),n.keys.forEach(function(n,t){e[n.name]=i[t]}),n.handler(e),r}),r})},function(n){(0,n.send)("blob.register",function(){var n,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments[1],i=arguments[2],o=(r.match(w)||[]).map(function(n){return{name:n.replace(/^:/g,"")}}),a=void 0;return"**"===r?a=/.*/g:(n=r.replace(/([^\w:])/g,"\\$1").replace(w,"([^/]*)"),a=new t.RegExp("^"+n+"(:?\\?.*)?$")),e.push({keys:o,pattern:a,handler:i}),e})},function(n){n.on;var t=n.send;t("blob.primary",function(n,e){a(n)?t("blob.builder",n()):t("blob.route",{path:n,handler:function(n){t("blob.builder",e(n))}})})}];g.kit="lite",g.version="3.0.2",g.lite=g,t.okwolo=g}).call(this);